machine:
  services:
    - docker
  environment:
    LOG_TOKEN: $LOG_TOKEN
dependencies:
  override:
    - docker info
    - docker build -t htmlgraphic/apache:latest .
test:
  override:
    # stop MySQL from running
    - sudo service mysql stop
    # test apache
    - docker-compose -f docker-compose.local.yml up -d; sleep 20
    - wget -q -O- http://127.0.0.1 | grep -w "dev"
    - wget -q -O- --no-check-certificate https://127.0.0.1 | grep -w "dev"
    - docker-compose -f docker-compose.local.yml kill; sleep 20
    - docker-compose up -d; sleep 20
    - wget -q -O- http://127.0.0.1 | grep -w "production"
    - wget -q -O- --no-check-certificate https://127.0.0.1 | grep -w "production"
